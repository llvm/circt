//===- Common.h - Common declarations for the ArcRuntime ------------------===//
//
// Part of the LLVM Project, under the Apache License v2.0 with LLVM Exceptions.
// See https://llvm.org/LICENSE.txt for license information.
// SPDX-License-Identifier: Apache-2.0 WITH LLVM-exception
//
//===----------------------------------------------------------------------===//
//
// Declares common structs for the ArcRuntime.
//
// This file belongs to both the public and internal API of the ArcRuntime.
// Changes to the internal API must be reflected in the lowering passes of the
// MLIR model.
//
//===----------------------------------------------------------------------===//

#ifndef CIRCT_TOOLS_ARCILATOR_ARCRUNTIME_COMMON_H
#define CIRCT_TOOLS_ARCILATOR_ARCRUNTIME_COMMON_H

#include <stdint.h>

/// Version of the combined public and internal API.
#define ARC_RUNTIME_API_VERSION UINT64_C(0)

/// Magic number used to assert the presence of an `ArcState` struct.
#define ARC_RUNTIME_MAGIC UINT32_C(0xAC1BB1CA)

#pragma pack(push, 1)

// Note: The ArcState struct uses a flexible array member to contain the
// variable-length hardware model state. This adheres to the C99 standard.
// It is not standard C++ but widely supported by C++ compilers, even though
// they might emit a warning.

/// Combined runtime and model state for a hardware model instance.
struct ArcState {
  /// Runtime implementation specific data. Usually points to a custom struct.
  void *impl;
  /// Padding for alignment and reserved for future use.
  uint32_t reserved;
  /// Runtime magic number. Must be set to `ARC_RUNTIME_MAGIC`.
  uint32_t magic;
  // The model's state.
  uint8_t modelState[];
};

/// Static information for a compiled hardware model, generated by the
/// MLIR lowering.
struct ArcRuntimeModelInfo {
  /// Runtime API version used when compiling the model.
  uint64_t apiVersion;
  /// Number of bytes required for the model's state.
  uint64_t numStateBytes;
  /// Name of the compiled model.
  const char *modelName;
};

#pragma pack(pop)

#endif // CIRCT_TOOLS_ARCILATOR_ARCRUNTIME_COMMON_H
